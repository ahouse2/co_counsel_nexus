name: ACE Validation Pipeline

on:
  pull_request:
    branches:
      - main

permissions:
  contents: read
  pull-requests: write

jobs:
  retriever:
    uses: ./.github/workflows/ace_retriever.yml
    with:
      pr-number: ${{ github.event.number }}
      base-ref: ${{ github.event.pull_request.base.ref }}
      head-ref: ${{ github.event.pull_request.head.sha }}
    secrets:
      github-token: ${{ secrets.GITHUB_TOKEN }}

  planner:
    needs: retriever
    uses: ./.github/workflows/ace_planner.yml
    with:
      pr-number: ${{ github.event.number }}
      head-ref: ${{ github.event.pull_request.head.sha }}
      retriever-artifact: ace-retriever-${{ github.event.number }}
    secrets:
      github-token: ${{ secrets.GITHUB_TOKEN }}

  critic:
    needs: planner
    uses: ./.github/workflows/ace_critic.yml
    with:
      pr-number: ${{ github.event.number }}
      head-ref: ${{ github.event.pull_request.head.sha }}
      retriever-artifact: ace-retriever-${{ github.event.number }}
      planner-artifact: ace-planner-${{ github.event.number }}
    secrets:
      github-token: ${{ secrets.GITHUB_TOKEN }}
